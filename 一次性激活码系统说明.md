# 央萨尔藏文编码转换器 - 一次性激活码系统

## 系统概述

本系统实现了真正的一次性激活码功能，具有以下特点：

### 🔐 安全性特性
- **一次性使用**：每个激活码只能使用一次，激活后立即失效
- **防重复激活**：即使换电脑、换浏览器也无法重复使用
- **本地验证**：无需网络连接，完全本地验证
- **时间控制**：从激活当天开始计时，到期自动失效

### 📅 时间管理
- **激活日期**：用户输入激活码的当天
- **有效期**：从激活日期开始计算（试用版30天，年度版365天）
- **到期处理**：到期后软件功能受限，需要新的激活码

## 激活码格式

### 数据结构
```
激活日期|到期日期|许可证类型|签名
```

### 示例
```
2025-07-10|2025-08-09|trial|a868b863012bb4aa
```

### 编码方式
- 使用Base64编码
- 特殊字符替换：`+` → `-`，`/` → `_`，`=` → 移除

## 技术实现

### 1. 激活码生成
```python
# 生成脚本：generate_codes.py
def generate_activation_code(license_type, days, activation_date=None):
    # 计算到期日期
    expire_date = activation_date + timedelta(days=days)
    
    # 创建数据包
    data = f"{activation_date}|{expire_date}|{license_type}"
    
    # 生成HMAC签名
    signature = hmac.new(SECRET, data, hashlib.sha256).hexdigest()[:16]
    
    # 组合并编码
    combined = f"{data}|{signature}"
    return base64_encode(combined)
```

### 2. 前端验证
```javascript
// 验证逻辑：LicenseModal.jsx
function verifyCode(inputCode) {
    // 解码激活码
    const decoded = atob(inputCode.replace(/-/g, '+').replace(/_/g, '/'));
    const [activationDate, expireDate, licenseType, sign] = decoded.split('|');
    
    // 验证签名
    const data = `${activationDate}|${expireDate}|${licenseType}`;
    const expectedSign = CryptoJS.HmacSHA256(data, SECRET).toString().slice(0, 16);
    
    // 检查有效期
    const now = new Date();
    const exp = new Date(expireDate);
    return now <= exp;
}
```

### 3. 防重复使用机制
```javascript
// 检查激活码是否已被使用
function checkCodeUsage(code) {
    const usedCodes = JSON.parse(localStorage.getItem('usedCodes') || '[]');
    return usedCodes.includes(code);
}

// 标记激活码为已使用
function markCodeAsUsed(code) {
    const usedCodes = JSON.parse(localStorage.getItem('usedCodes') || '[]');
    if (!usedCodes.includes(code)) {
        usedCodes.push(code);
        localStorage.setItem('usedCodes', JSON.stringify(usedCodes));
    }
}
```

## 使用流程

### 1. 用户激活流程
1. 用户获得激活码
2. 在软件中输入激活码
3. 系统验证激活码有效性
4. 检查激活码是否已被使用
5. 激活成功，标记激活码为已使用
6. 保存激活信息到本地存储

### 2. 激活码验证流程
1. 解码激活码获取信息
2. 验证HMAC签名
3. 检查激活码是否已被使用
4. 验证当前时间是否在有效期内
5. 返回验证结果

### 3. 到期处理
1. 软件启动时检查激活状态
2. 如果已激活，检查是否过期
3. 如果过期，显示到期提示
4. 限制软件功能，要求重新激活

## 文件说明

### 生成的文件
- `trial_codes.txt` - 试用版激活码（1000个）
- `yearly_codes.txt` - 年度版激活码（1000个）
- `activation_codes.json` - JSON格式激活码数据

### 代码文件
- `generate_codes.py` - 激活码生成脚本
- `src/components/LicenseModal.jsx` - 激活界面组件
- `test_activation.py` - 激活码测试脚本

## 安全优势

### ✅ 防破解
- HMAC签名防止篡改
- 本地存储防止网络攻击
- 一次性使用防止重复激活

### ✅ 用户体验
- 无需网络连接
- 激活过程简单快速
- 到期提醒清晰明确

### ✅ 商业保护
- 防止激活码泄露
- 控制软件使用期限
- 支持批量生成和分发

## 测试方法

### 1. 生成测试激活码
```bash
python3 generate_codes.py
```

### 2. 验证激活码格式
```bash
python3 test_activation.py
```

### 3. 前端测试
1. 启动开发服务器：`npm start`
2. 打开浏览器访问：`http://localhost:3000`
3. 测试激活流程
4. 测试重复激活（应该失败）
5. 测试过期激活码

## 注意事项

1. **激活码安全**：激活码生成后应妥善保管，避免泄露
2. **本地存储**：激活信息存储在浏览器本地，清除浏览器数据会丢失激活状态
3. **时间同步**：建议用户确保系统时间准确，避免激活问题
4. **备份恢复**：重要激活码建议备份，以防意外丢失

## 扩展功能

### 未来可能的改进
- 添加激活码黑名单功能
- 支持激活码续期功能
- 添加激活统计和报告
- 支持多设备激活限制
- 添加激活码批量管理工具 